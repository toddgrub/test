<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM LOCKDOWN</title>
    <style>
        /* --- CORE STYLES --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --red: #ff0000;
            --dark-red: #4a0000;
            --bg: #050000;
            --glass: rgba(10, 0, 0, 0.85);
        }
        body {
            background-color: var(--bg);
            background-image: radial-gradient(circle at center, #2a0000 0%, #000000 100%);
            color: var(--red);
            font-family: 'Courier New', Courier, monospace;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- FX LAYERS --- */
        .scanlines {
            position: fixed; inset: 0; pointer-events: none; z-index: 10;
            background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.3) 50%);
            background-size: 100% 4px;
        }
        .vignette {
            position: fixed; inset: 0; pointer-events: none; z-index: 2;
            background: radial-gradient(circle, transparent 40%, black 150%);
        }

        /* --- MAIN CONTAINER --- */
        .container {
            position: relative; z-index: 5; text-align: center;
            border: 2px solid var(--red); background: var(--glass);
            padding: 3rem 4rem;
            box-shadow: 0 0 40px var(--dark-red), inset 0 0 20px var(--dark-red);
            backdrop-filter: blur(5px);
            min-width: 600px;
        }

        h1 { font-size: 3rem; text-transform: uppercase; margin-bottom: 0.5rem; text-shadow: 0 0 15px var(--red); }
        .timer { font-size: 6rem; font-weight: bold; text-shadow: 0 0 20px var(--red); line-height: 1; margin: 20px 0; }
        .sub-text { border-bottom: 1px solid var(--red); display: inline-block; padding-bottom: 5px; letter-spacing: 2px; }

        /* --- SETUP PANEL (Hidden by default) --- */
        #setup-panel { display: none; }
        .setup-input {
            background: black; border: 1px solid var(--red); color: var(--red);
            font-family: 'Courier New', monospace; font-size: 1.5rem;
            padding: 10px; width: 100px; text-align: center; margin-right: 10px;
        }
        .btn {
            background: var(--red); color: black; border: none;
            font-family: 'Courier New', monospace; font-size: 1.2rem; font-weight: bold;
            padding: 12px 24px; cursor: pointer; text-transform: uppercase;
        }
        .btn:hover { background: white; box-shadow: 0 0 15px white; }
        
        .generated-link-box {
            margin-top: 20px; border: 1px dashed var(--red); padding: 15px;
            word-break: break-all; font-size: 0.9rem; background: rgba(0,0,0,0.5);
            display: none;
        }

        /* --- ANIMATIONS --- */
        @keyframes pulse { from { opacity: 1; } to { opacity: 0.7; text-shadow: 0 0 30px red; } }
        .hazard-striped {
            background: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,0,0,0.1) 10px, rgba(255,0,0,0.1) 20px);
            position: absolute; inset: 0; z-index: -1;
        }
        
        /* Panic Mode Style */
        .critical { animation: pulse 0.2s infinite alternate; color: #fff; }
    </style>
</head>
<body>

    <div class="scanlines"></div>
    <div class="vignette"></div>

    <div class="container">
        <div class="hazard-striped"></div>
        
        <!-- COUNTDOWN MODE -->
        <div id="timer-display">
            <div style="font-size: 4rem;">⚠️</div>
            <h1>System Purge</h1>
            <p class="sub-text">TIME UNTIL TOTAL FAILURE</p>
            
            <div class="timer" id="countdown">00:00</div>
            
            <div style="font-size: 0.7rem; opacity: 0.6; margin-top:20px;">
                SESSION ID: <span id="session-id">LOADING...</span>
            </div>
        </div>

        <!-- SETUP MODE (Only visible if no time set) -->
        <div id="setup-panel">
            <h1>INITIALIZE TEST</h1>
            <p style="margin-bottom: 20px;">ENTER DURATION (MINUTES)</p>
            
            <div style="margin-bottom: 20px;">
                <input type="number" id="minutes-input" class="setup-input" value="10" min="1">
                <button class="btn" onclick="generateLink()">GENERATE KIOSK LINK</button>
            </div>

            <div id="result-area" class="generated-link-box">
                <p style="color:white; margin-bottom:5px;">COPY THIS URL INTO KIOSK SETTINGS:</p>
                <a id="final-link" href="#" style="color: var(--red); text-decoration: none;">...</a>
            </div>
        </div>
    </div>

    <script>
        // Check URL for "end" timestamp
        const params = new URLSearchParams(window.location.search);
        const endParam = params.get('end');

        const displayDiv = document.getElementById('timer-display');
        const setupDiv = document.getElementById('setup-panel');
        const countdownEl = document.getElementById('countdown');

        // --- SCENARIO 1: SETUP MODE (No URL Param) ---
        if (!endParam) {
            displayDiv.style.display = 'none';
            setupDiv.style.display = 'block';
        } 
        // --- SCENARIO 2: RUN MODE (URL Param Exists) ---
        else {
            setupDiv.style.display = 'none';
            displayDiv.style.display = 'block';
            document.getElementById('session-id').innerText = endParam.slice(-6);
            startTimer(parseInt(endParam));
        }

        // --- FUNCTION: Generate the Kiosk Link ---
        function generateLink() {
            const mins = document.getElementById('minutes-input').value;
            const now = new Date().getTime();
            // Calculate target timestamp: Now + Minutes
            const targetTime = now + (mins * 60 * 1000);
            
            // Create the new URL
            const baseUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
            const newUrl = `${baseUrl}?end=${targetTime}`;

            // Show it to the user
            document.getElementById('result-area').style.display = 'block';
            const linkEl = document.getElementById('final-link');
            linkEl.innerText = newUrl;
            linkEl.href = newUrl;
            
            // Optional: Automatically go there to test
            // window.location.href = newUrl; 
        }

        // --- FUNCTION: Run the Timer ---
        function startTimer(endTime) {
            const interval = setInterval(() => {
                const now = new Date().getTime();
                const distance = endTime - now;

                if (distance < 0) {
                    clearInterval(interval);
                    countdownEl.innerHTML = "00:00";
                    countdownEl.classList.add("critical");
                    document.querySelector("h1").innerText = "FAILURE";
                    return;
                }

                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                const m = minutes < 10 ? "0" + minutes : minutes;
                const s = seconds < 10 ? "0" + seconds : seconds;

                countdownEl.innerHTML = `${m}:${s}`;

                // Panic visual effects
                if (minutes === 0) {
                    document.body.style.background = distance % 1000 < 500 ? "#200000" : "black";
                    countdownEl.style.textShadow = "0 0 40px red";
                }

            }, 1000);
            
            // Run once immediately
            const now = new Date().getTime();
            if(endTime - now < 0) {
                 countdownEl.innerHTML = "00:00";
            }
        }
    </script>
</body>
</html>
